<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explainer Card</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.protograph.pykih.com/Assets/semantic.min.css">
</head>

<body>
    <div id="explainer-div"></div>
    <link rel="stylesheet" type="text/css" href="card.min.css">
    <script src="card.min.js"></script>
    <script type="text/javascript">
    var x = new ProtoGraph.Card.toExplain();

    function findGetParameter(parameterName) {
        var result = null,
            tmp = [],
            search_url = decodeURIComponent(location.search);

        search_url
            .substr(1)
            .split("&")
            .forEach(function(item) {
                tmp = item.split("=");
                if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
            });
        return result;
    }

    let view_cast_id = findGetParameter('view_cast_id'),
        schema_id = findGetParameter('schema_id'),
        mode = findGetParameter('mode'),
        readMoreEnabled = true,
        base_url = findGetParameter('base_url') || "https://cdn.protograph.pykih.com",
        schema_base_url = "https://cdn.protograph.pykih.com";

    if (typeof(view_cast_id) !== 'undefined' && typeof(schema_id) !== 'undefined') {
        var data_base_path = base_url + "/" + view_cast_id,
            schema_base_path = schema_base_url + "/" + schema_id;

        x.init({
            viewCastId: view_cast_id,
            selector: document.querySelector('#explainer-div'),
            data_url: data_base_path + "/data.json",
            schema_url: schema_base_path + "/schema.json",
            configuration_url: data_base_path + "/view_cast.json",
            configuration_schema_url: './configuration_schema.json',
            site_config_url: "./site.json",
            onClickCallback: function() {
                let h = x.getData().height;
                that.send('resize_frame', { width: '100%', height: h })
            }
        })
        renderWithMode(mode, readMoreEnabled);
    }

    function renderWithMode(mode, readMoreEnabled) {
        switch (mode) {
            case "laptop":
                x.renderLaptop(readMoreEnabled);
                break;
            case "mobile":
            default:
                x.renderMobile(readMoreEnabled);
                break;
        }
    }
    </script>
</body>

</html>